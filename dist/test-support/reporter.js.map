{"version":3,"file":"reporter.js","sources":["../../src/test-support/reporter.ts"],"sourcesContent":["import QUnit from 'qunit';\nimport formatViolation from './format-violation.ts';\nimport { storeResults } from './logger.ts';\n\nimport type { AxeResults } from 'axe-core';\nimport type { A11yAuditReporter } from './types';\n\nexport const DEFAULT_REPORTER = (results: AxeResults) => {\n  const violations = results.violations;\n\n  storeResults(results);\n\n  if (violations.length) {\n    const allViolations = violations.map((violation) => {\n      const violationNodes = violation.nodes.map((node) => node.html);\n\n      return formatViolation(violation, violationNodes);\n    });\n\n    const allViolationMessages = allViolations.join('\\n');\n    throw new Error(\n      `The page should have no accessibility violations. Violations:\\n${allViolationMessages}\nTo rerun this specific failure, use the following query params: &testId=${(QUnit.config.current as { testId: string }).testId}&enableA11yAudit=true`,\n    );\n  }\n};\n\n/**\n * Reports the results of the a11yAudit. Set a custom reporter using `setCustomReporter`.\n */\nexport let reportA11yAudit: A11yAuditReporter = DEFAULT_REPORTER;\n\n/**\n * Sets a custom reporter, allowing implementers more specific control over how the results of the\n * `a11yAudit` calls are processed. Calling this function with no parameters will reset the reporter\n * to the default reporter.\n *\n * @param customReporter {A11yAuditReporter} The reporter to use in a11yAudit\n */\nexport function setCustomReporter(\n  customReporter: A11yAuditReporter = DEFAULT_REPORTER,\n) {\n  reportA11yAudit = customReporter;\n}\n"],"names":["DEFAULT_REPORTER","results","violations","storeResults","length","allViolations","map","violation","violationNodes","nodes","node","html","formatViolation","allViolationMessages","join","Error","QUnit","config","current","testId","reportA11yAudit","setCustomReporter","customReporter"],"mappings":";;;;AAOO,MAAMA,gBAAgB,GAAIC,OAAmB,IAAK;AACvD,EAAA,MAAMC,UAAU,GAAGD,OAAO,CAACC,UAAU;EAErCC,YAAY,CAACF,OAAO,CAAC;EAErB,IAAIC,UAAU,CAACE,MAAM,EAAE;AACrB,IAAA,MAAMC,aAAa,GAAGH,UAAU,CAACI,GAAG,CAAEC,SAAS,IAAK;AAClD,MAAA,MAAMC,cAAc,GAAGD,SAAS,CAACE,KAAK,CAACH,GAAG,CAAEI,IAAI,IAAKA,IAAI,CAACC,IAAI,CAAC;AAE/D,MAAA,OAAOC,eAAe,CAACL,SAAS,EAAEC,cAAc,CAAC;AACnD,IAAA,CAAC,CAAC;AAEF,IAAA,MAAMK,oBAAoB,GAAGR,aAAa,CAACS,IAAI,CAAC,IAAI,CAAC;AACrD,IAAA,MAAM,IAAIC,KAAK,CACb,CAAA,+DAAA,EAAkEF,oBAAoB;AAC5F,wEAAA,EAA2EG,KAAK,CAACC,MAAM,CAACC,OAAO,CAAwBC,MAAM,uBACzH,CAAC;AACH,EAAA;AACF;;AAEA;AACA;AACA;AACO,IAAIC,eAAkC,GAAGpB;;AAEhD;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASqB,iBAAiBA,CAC/BC,cAAiC,GAAGtB,gBAAgB,EACpD;AACAoB,EAAAA,eAAe,GAAGE,cAAc;AAClC;;;;"}