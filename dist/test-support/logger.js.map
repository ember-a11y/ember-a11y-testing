{"version":3,"file":"logger.js","sources":["../../src/test-support/logger.ts"],"sourcesContent":["import axeCore from 'axe-core';\n\nimport type { AxeResults, NodeResult, RelatedNode, Result } from 'axe-core';\n\n/**\n * This file is heavily borrowed from https://github.com/dequelabs/react-axe/blob/d3245b32fc5ed19e3c7b2c43d2815fe63f5875cb/index.ts\n *\n * An issue (https://github.com/dequelabs/react-axe/issues/180) has been opened which\n * suggests extracting out the common pieces of axe formatting to a separate repository,\n * which would allow a lot of these functions to be removed.\n */\n\n// @reference axe-core https://github.com/dequelabs/axe-core/blob/develop/lib/core/base/audit.js\ntype AxeCoreNodeResultKey = 'any' | 'all' | 'none';\n\ninterface AxeWithAudit {\n  _audit: {\n    data: {\n      failureSummaries: {\n        any: {\n          failureMessage: (args: string[]) => string;\n        };\n        all: {\n          failureMessage: (args: string[]) => string;\n        };\n        none: {\n          failureMessage: (args: string[]) => string;\n        };\n      };\n    };\n  };\n}\n\n// contrasted against Chrome default color of #ffffff\nconst lightTheme = {\n  serious: '#d93251',\n  minor: '#d24700',\n  text: 'black',\n};\n\n// contrasted against Safari dark mode color of #535353\nconst darkTheme = {\n  serious: '#ffb3b3',\n  minor: '#ffd500',\n  text: 'white',\n};\n\nconst theme =\n  window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches\n    ? darkTheme\n    : lightTheme;\n\nconst boldCourier = 'font-weight:bold;font-family:Courier;';\nconst critical = `color:${theme.serious};font-weight:bold;`;\nconst serious = `color:${theme.serious};font-weight:normal;`;\nconst moderate = `color:${theme.minor};font-weight:bold;`;\nconst minor = `color:${theme.minor};font-weight:normal;`;\nconst defaultReset = `font-color:${theme.text};font-weight:normal;`;\n\nconst testSuiteResults: Result[][] = [];\nconst cache: { [key: string]: string } = {};\n\nfunction deduplicateViolations(results: AxeResults) {\n  return results.violations.filter((result) => {\n    result.nodes = result.nodes.filter((node) => {\n      const key: string = node.target.toString() + result.id;\n      const retVal = !cache[key];\n      cache[key] = key;\n      return retVal;\n    });\n    return !!result.nodes.length;\n  });\n}\n\n/**\n * Log the axe result node to the console\n *\n * @param {NodeResult} node\n * @param {Function} logFn console log function to use (error, warn, log, etc.)\n */\nfunction logElement(\n  node: NodeResult | RelatedNode,\n  logFn: (...args: unknown[]) => void,\n): void {\n  const el = document.querySelector(node.target.toString());\n  if (!el) {\n    logFn('Selector: %c%s', boldCourier, node.target.toString());\n  } else {\n    logFn('Element: %o', el);\n  }\n}\n\n/**\n * Log the axe result node html to the console\n *\n * @param {NodeResult} node\n */\nfunction logHtml(node: NodeResult | RelatedNode): void {\n  console.log('HTML: %c%s', boldCourier, node.html);\n}\n\n/**\n * Log the failure message of a node result.\n *\n * @param {NodeResult} node\n * @param {String} key which check array to log from (any, all, none)\n */\nfunction logFailureMessage(node: NodeResult, key: AxeCoreNodeResultKey): void {\n  // this exists on axe but we don't export it as part of the typescript\n  // namespace, so just let me use it as I need\n  const message: string = (\n    axeCore as unknown as AxeWithAudit\n  )._audit.data.failureSummaries[key].failureMessage(\n    node[key].map((check) => check.message || ''),\n  );\n\n  console.error(message);\n}\n\n/**\n * Log as a group the node result and failure message.\n *\n * @param {NodeResult} node\n * @param {String} key which check array to log from (any, all, none)\n */\nfunction failureSummary(node: NodeResult, key: AxeCoreNodeResultKey): void {\n  if (node[key].length > 0) {\n    logElement(node, console.groupCollapsed);\n    logHtml(node);\n    logFailureMessage(node, key);\n\n    let relatedNodes: RelatedNode[] = [];\n    node[key].forEach((check) => {\n      relatedNodes = relatedNodes.concat(check.relatedNodes || []);\n    });\n\n    if (relatedNodes.length > 0) {\n      console.groupCollapsed('Related nodes');\n      relatedNodes.forEach((relatedNode) => {\n        logElement(relatedNode, console.log);\n        logHtml(relatedNode);\n      });\n      console.groupEnd();\n    }\n\n    console.groupEnd();\n  }\n}\n\n/**\n * @public\n * @param results The axe results.\n */\nexport function storeResults(results: AxeResults) {\n  if (results.violations.length > 0) {\n    testSuiteResults.push(deduplicateViolations(results));\n  }\n}\n\n/**\n * Prints aggregated axe results to the console.\n *\n * @public\n */\nexport function printResults() {\n  if (testSuiteResults.length) {\n    console.group('%cAxe issues', serious);\n    testSuiteResults.forEach((results) => {\n      results.forEach((result) => {\n        let fmt: string;\n        switch (result.impact) {\n          case 'critical':\n            fmt = critical;\n            break;\n          case 'serious':\n            fmt = serious;\n            break;\n          case 'moderate':\n            fmt = moderate;\n            break;\n          case 'minor':\n            fmt = minor;\n            break;\n          default:\n            fmt = minor;\n            break;\n        }\n        console.groupCollapsed(\n          '%c%s: %c%s %s',\n          fmt,\n          result.impact,\n          defaultReset,\n          result.help,\n          result.helpUrl,\n        );\n        result.nodes.forEach((node) => {\n          failureSummary(node, 'any');\n          failureSummary(node, 'none');\n        });\n        console.groupEnd();\n      });\n    });\n    console.groupEnd();\n  }\n}\n"],"names":["lightTheme","serious","minor","text","darkTheme","theme","window","matchMedia","matches","boldCourier","critical","moderate","defaultReset","testSuiteResults","cache","deduplicateViolations","results","violations","filter","result","nodes","node","key","target","toString","id","retVal","length","logElement","logFn","el","document","querySelector","logHtml","console","log","html","logFailureMessage","message","axeCore","_audit","data","failureSummaries","failureMessage","map","check","error","failureSummary","groupCollapsed","relatedNodes","forEach","concat","relatedNode","groupEnd","storeResults","push","printResults","group","fmt","impact","help","helpUrl"],"mappings":"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"}