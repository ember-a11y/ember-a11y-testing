{"version":3,"file":"setup-global-a11y-hooks.js","sources":["../../src/test-support/setup-global-a11y-hooks.ts"],"sourcesContent":["import { registerHook } from '@ember/test-helpers';\nimport { getRunOptions } from './run-options.ts';\nimport a11yAudit from './audit.ts';\nimport { shouldForceAudit } from './should-force-audit.ts';\n\nimport type { HookUnregister } from '@ember/test-helpers';\nimport type { InvocationStrategy, AuditFunction } from './types';\n\nexport interface GlobalA11yHookOptions {\n  helpers: HelperName[];\n}\n\ntype HelperName =\n  | 'blur'\n  | 'click'\n  | 'doubleClick'\n  | 'fillIn'\n  | 'focus'\n  | 'render'\n  | 'scrollTo'\n  | 'select'\n  | 'tab'\n  | 'tap'\n  | 'triggerEvent'\n  | 'triggerKeyEvent'\n  | 'typeIn'\n  | 'visit';\n\nconst _unregisterHooks: HookUnregister[] = [];\n\nexport const DEFAULT_A11Y_TEST_HELPER_NAMES: HelperName[] = [\n  'visit',\n  'click',\n  'doubleClick',\n  'tap',\n];\n\n/**\n * Sets up a11yAudit calls using `@ember/test-helpers`' `registerHook` API.\n *\n * @param shouldAudit Invocation strategy function that determines whether to run the audit helper or not.\n * @param audit Optional audit function used to run the audit. Allows for providing either a11yAudit\n *              or custom audit implementation.\n */\nexport function setupGlobalA11yHooks(shouldAudit: InvocationStrategy): void;\nexport function setupGlobalA11yHooks(\n  shouldAudit: InvocationStrategy,\n  audit: AuditFunction,\n): void;\nexport function setupGlobalA11yHooks(\n  shouldAudit: InvocationStrategy,\n  options: GlobalA11yHookOptions,\n): void;\nexport function setupGlobalA11yHooks(\n  shouldAudit: InvocationStrategy,\n  audit: AuditFunction,\n  options: GlobalA11yHookOptions,\n): void;\nexport function setupGlobalA11yHooks(\n  shouldAudit: InvocationStrategy,\n  auditOrOptions?: AuditFunction | GlobalA11yHookOptions,\n  options?: GlobalA11yHookOptions,\n): void {\n  let audit: AuditFunction = a11yAudit;\n\n  if (typeof auditOrOptions === 'function') {\n    audit = auditOrOptions;\n  } else {\n    options = auditOrOptions;\n  }\n\n  const helpers = options?.helpers ?? DEFAULT_A11Y_TEST_HELPER_NAMES;\n\n  helpers.forEach((helperName) => {\n    const hook = registerHook(helperName, 'end', async () => {\n      if (shouldForceAudit() && shouldAudit(helperName, 'end')) {\n        await audit(getRunOptions());\n      }\n    });\n\n    _unregisterHooks.push(hook);\n  });\n}\n\n/**\n * Function to teardown the configured hooks. Used specifically in testing.\n */\nexport function teardownGlobalA11yHooks() {\n  while (_unregisterHooks.length) {\n    const hook = _unregisterHooks.shift()!;\n    hook.unregister();\n  }\n}\n"],"names":["_unregisterHooks","DEFAULT_A11Y_TEST_HELPER_NAMES","setupGlobalA11yHooks","shouldAudit","auditOrOptions","options","audit","a11yAudit","helpers","forEach","helperName","hook","registerHook","shouldForceAudit","getRunOptions","push","teardownGlobalA11yHooks","length","shift","unregister"],"mappings":";;;;;AA4BA,MAAMA,gBAAkC,GAAG,EAAE;AAEtC,MAAMC,8BAA4C,GAAG,CAC1D,OAAO,EACP,OAAO,EACP,aAAa,EACb,KAAK;;AAGP;AACA;AACA;AACA;AACA;AACA;AACA;;AAeO,SAASC,oBAAoBA,CAClCC,WAA+B,EAC/BC,cAAsD,EACtDC,OAA+B,EACzB;EACN,IAAIC,KAAoB,GAAGC,SAAS;AAEpC,EAAA,IAAI,OAAOH,cAAc,KAAK,UAAU,EAAE;AACxCE,IAAAA,KAAK,GAAGF,cAAc;AACxB,EAAA,CAAC,MAAM;AACLC,IAAAA,OAAO,GAAGD,cAAc;AAC1B,EAAA;AAEA,EAAA,MAAMI,OAAO,GAAGH,OAAO,EAAEG,OAAO,IAAIP,8BAA8B;AAElEO,EAAAA,OAAO,CAACC,OAAO,CAAEC,UAAU,IAAK;IAC9B,MAAMC,IAAI,GAAGC,YAAY,CAACF,UAAU,EAAE,KAAK,EAAE,YAAY;MACvD,IAAIG,gBAAgB,EAAE,IAAIV,WAAW,CAACO,UAAU,EAAE,KAAK,CAAC,EAAE;AACxD,QAAA,MAAMJ,KAAK,CAACQ,aAAa,EAAE,CAAC;AAC9B,MAAA;AACF,IAAA,CAAC,CAAC;AAEFd,IAAAA,gBAAgB,CAACe,IAAI,CAACJ,IAAI,CAAC;AAC7B,EAAA,CAAC,CAAC;AACJ;;AAEA;AACA;AACA;AACO,SAASK,uBAAuBA,GAAG;EACxC,OAAOhB,gBAAgB,CAACiB,MAAM,EAAE;AAC9B,IAAA,MAAMN,IAAI,GAAGX,gBAAgB,CAACkB,KAAK,EAAG;IACtCP,IAAI,CAACQ,UAAU,EAAE;AACnB,EAAA;AACF;;;;"}