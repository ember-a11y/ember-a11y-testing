{"version":3,"file":"should-force-audit.js","sources":["../../src/test-support/should-force-audit.ts"],"sourcesContent":["/**\n * In v1, this was set to `true` at build time by `CliOptionsFilter` when\n * the `ENABLE_A11Y_AUDIT` environment variable was set. In v2 addons,\n * there is no build-time rewriting. Use the `?enableA11yAudit` query param\n * or call `setEnableA11yAudit(true)` programmatically instead.\n */\nconst ENABLE_A11Y_AUDIT = false;\n\nexport function _calculateUpdatedHref(\n  href: string,\n  baseURI: string,\n  enabled: boolean = false,\n): string {\n  const url = new URL(href, baseURI);\n  const initialHref = url.href;\n\n  // Set up the `enableA11yAudit` query param\n  if (enabled) {\n    url.searchParams.set('enableA11yAudit', '');\n  } else {\n    url.searchParams.delete('enableA11yAudit');\n  }\n\n  // Match all key-only params with '='\n  return url.href.replace(/([^?&]+)=(?=&|$)/g, (match: string, sub: string) => {\n    // Only normalize `enableA11yAudit` or params that didn't initially include '='\n    return sub === 'enableA11yAudit' || !initialHref.includes(match)\n      ? sub\n      : match;\n  });\n}\n\nexport function setEnableA11yAudit(enabled: boolean = false) {\n  const href = _calculateUpdatedHref(\n    window.location.href,\n    document.baseURI,\n    enabled,\n  );\n\n  // Update the URL without reloading\n  window.history.replaceState(null, '', href);\n}\n\n/**\n * Forces running audits. This functionality is enabled by\n * the presence of an `enableA11yAudit` query parameter passed to the test suite\n * or the `ENABLE_A11Y_AUDIT` environment variable.\n *\n * If used with `setupGlobalA11yHooks` and the query param enabled, this will override\n * any `InvocationStrategy` passed to that function and force the audit.\n */\nexport function shouldForceAudit() {\n  const url = new URL(window.location.href, document.baseURI);\n\n  return ENABLE_A11Y_AUDIT || url.searchParams.get('enableA11yAudit') !== null;\n}\n"],"names":["_calculateUpdatedHref","href","baseURI","enabled","url","URL","initialHref","searchParams","set","delete","replace","match","sub","includes","setEnableA11yAudit","window","location","document","history","replaceState","shouldForceAudit","get"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AAGO,SAASA,qBAAqBA,CACnCC,IAAY,EACZC,OAAe,EACfC,OAAgB,GAAG,KAAK,EAChB;EACR,MAAMC,GAAG,GAAG,IAAIC,GAAG,CAACJ,IAAI,EAAEC,OAAO,CAAC;AAClC,EAAA,MAAMI,WAAW,GAAGF,GAAG,CAACH,IAAI;;AAE5B;AACA,EAAA,IAAIE,OAAO,EAAE;IACXC,GAAG,CAACG,YAAY,CAACC,GAAG,CAAC,iBAAiB,EAAE,EAAE,CAAC;AAC7C,EAAA,CAAC,MAAM;AACLJ,IAAAA,GAAG,CAACG,YAAY,CAACE,MAAM,CAAC,iBAAiB,CAAC;AAC5C,EAAA;;AAEA;AACA,EAAA,OAAOL,GAAG,CAACH,IAAI,CAACS,OAAO,CAAC,mBAAmB,EAAE,CAACC,KAAa,EAAEC,GAAW,KAAK;AAC3E;AACA,IAAA,OAAOA,GAAG,KAAK,iBAAiB,IAAI,CAACN,WAAW,CAACO,QAAQ,CAACF,KAAK,CAAC,GAC5DC,GAAG,GACHD,KAAK;AACX,EAAA,CAAC,CAAC;AACJ;AAEO,SAASG,kBAAkBA,CAACX,OAAgB,GAAG,KAAK,EAAE;AAC3D,EAAA,MAAMF,IAAI,GAAGD,qBAAqB,CAChCe,MAAM,CAACC,QAAQ,CAACf,IAAI,EACpBgB,QAAQ,CAACf,OAAO,EAChBC,OACF,CAAC;;AAED;EACAY,MAAM,CAACG,OAAO,CAACC,YAAY,CAAC,IAAI,EAAE,EAAE,EAAElB,IAAI,CAAC;AAC7C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASmB,gBAAgBA,GAAG;AACjC,EAAA,MAAMhB,GAAG,GAAG,IAAIC,GAAG,CAACU,MAAM,CAACC,QAAQ,CAACf,IAAI,EAAEgB,QAAQ,CAACf,OAAO,CAAC;EAE3D,OAA4BE,GAAG,CAACG,YAAY,CAACc,GAAG,CAAC,iBAAiB,CAAC,KAAK,IAAI;AAC9E;;;;"}